{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 138, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Danny/Desktop/Coding/DLS/my-app/src/app/api/verify/route.ts"],"sourcesContent":["import { NextRequest } from \"next/server\";\r\nimport Tesseract from \"tesseract.js\";\r\n\r\nconst extractCnicNumber = (ocrText: string) => {\r\n  // It has the format \"12345-1234567-1\"\r\n  const cnicRegex = /\\b\\d{5}-\\d{7}-\\d\\b/;\r\n  const match = ocrText.match(cnicRegex);\r\n  if (match) {\r\n    return match[0];\r\n  }\r\n  return null;\r\n};\r\n\r\n\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const formData = await req.formData();\r\n    const frontCnic = formData.get(\"frontCnic\") as File;\r\n    const backCnic = formData.get(\"backCnic\") as File;\r\n    \r\n    console.log(\"Received files:\", { \r\n      frontCnic: frontCnic?.name, \r\n      backCnic: backCnic?.name,\r\n      frontCnicSize: frontCnic?.size,\r\n      backCnicSize: backCnic?.size\r\n    });\r\n\r\n    if (!frontCnic || !backCnic) {\r\n      return new Response(\r\n        JSON.stringify({\r\n          error: \"Both front and back CNIC images are required.\",\r\n        }),\r\n        {\r\n          status: 400,\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n        }\r\n      );\r\n    }\r\n\r\n    // Convert File objects to Buffer for Tesseract\r\n    const frontBuffer = Buffer.from(await frontCnic.arrayBuffer());\r\n    const backBuffer = Buffer.from(await backCnic.arrayBuffer());\r\n\r\n    const workerFront = await Tesseract.createWorker(\"eng\");\r\n\r\n    const [frontText, backText] = await Promise.all([\r\n      workerFront.recognize(frontBuffer),\r\n      workerFront.recognize(backBuffer),\r\n    ]);\r\n\r\n    // Clean up workers\r\n    await workerFront.terminate();\r\n    await workerFront.terminate();\r\n\r\n    console.log(\"Front CNIC OCR Text:\", frontText.data.text);\r\n    console.log(\"Back CNIC OCR Text:\", backText.data.text);\r\n\r\n    const frontCnicNumber = extractCnicNumber(frontText.data.text);\r\n    const backCnicNumber = extractCnicNumber(backText.data.text);\r\n\r\n    if (!frontCnicNumber || !backCnicNumber) {\r\n      return new Response(\r\n        JSON.stringify({\r\n          error: \"Failed to extract CNIC numbers from the images.\",\r\n        }),\r\n        {\r\n          status: 400,\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n        }\r\n      );\r\n    }\r\n\r\n    if (frontCnicNumber === backCnicNumber) {\r\n      return new Response(\r\n        JSON.stringify({\r\n          success: true,\r\n          message: \"CNIC numbers match.\",\r\n          frontCnicNumber,\r\n          backCnicNumber,\r\n        }),\r\n        {\r\n          status: 200,\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n        }\r\n      );\r\n    } else {\r\n      return new Response(\r\n        JSON.stringify({\r\n          success: false,\r\n          error: \"CNIC numbers do not match.\",\r\n          frontCnicNumber,\r\n          backCnicNumber,\r\n        }),\r\n        {\r\n          status: 400,\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n        }\r\n      );\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error processing CNIC validation:\", error);\r\n    return new Response(\r\n      JSON.stringify({\r\n        success: false,\r\n        error: \"Internal server error during CNIC validation.\",\r\n      }),\r\n      {\r\n        status: 500,\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;AACA;;AAEA,MAAM,oBAAoB,CAAC;IACzB,sCAAsC;IACtC,MAAM,YAAY;IAClB,MAAM,QAAQ,QAAQ,KAAK,CAAC;IAC5B,IAAI,OAAO;QACT,OAAO,KAAK,CAAC,EAAE;IACjB;IACA,OAAO;AACT;AAIO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,YAAY,SAAS,GAAG,CAAC;QAC/B,MAAM,WAAW,SAAS,GAAG,CAAC;QAE9B,QAAQ,GAAG,CAAC,mBAAmB;YAC7B,WAAW,WAAW;YACtB,UAAU,UAAU;YACpB,eAAe,WAAW;YAC1B,cAAc,UAAU;QAC1B;QAEA,IAAI,CAAC,aAAa,CAAC,UAAU;YAC3B,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;gBACb,OAAO;YACT,IACA;gBACE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QAEJ;QAEA,+CAA+C;QAC/C,MAAM,cAAc,OAAO,IAAI,CAAC,MAAM,UAAU,WAAW;QAC3D,MAAM,aAAa,OAAO,IAAI,CAAC,MAAM,SAAS,WAAW;QAEzD,MAAM,cAAc,MAAM,iJAAA,CAAA,UAAS,CAAC,YAAY,CAAC;QAEjD,MAAM,CAAC,WAAW,SAAS,GAAG,MAAM,QAAQ,GAAG,CAAC;YAC9C,YAAY,SAAS,CAAC;YACtB,YAAY,SAAS,CAAC;SACvB;QAED,mBAAmB;QACnB,MAAM,YAAY,SAAS;QAC3B,MAAM,YAAY,SAAS;QAE3B,QAAQ,GAAG,CAAC,wBAAwB,UAAU,IAAI,CAAC,IAAI;QACvD,QAAQ,GAAG,CAAC,uBAAuB,SAAS,IAAI,CAAC,IAAI;QAErD,MAAM,kBAAkB,kBAAkB,UAAU,IAAI,CAAC,IAAI;QAC7D,MAAM,iBAAiB,kBAAkB,SAAS,IAAI,CAAC,IAAI;QAE3D,IAAI,CAAC,mBAAmB,CAAC,gBAAgB;YACvC,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;gBACb,OAAO;YACT,IACA;gBACE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QAEJ;QAEA,IAAI,oBAAoB,gBAAgB;YACtC,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;gBACb,SAAS;gBACT,SAAS;gBACT;gBACA;YACF,IACA;gBACE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QAEJ,OAAO;YACL,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;gBACb,SAAS;gBACT,OAAO;gBACP;gBACA;YACF,IACA;gBACE,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;YAChD;QAEJ;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,IAAI,SACT,KAAK,SAAS,CAAC;YACb,SAAS;YACT,OAAO;QACT,IACA;YACE,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;QAChD;IAEJ;AACF","debugId":null}}]
}